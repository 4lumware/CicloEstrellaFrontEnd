<form class="form-group-container" [formGroup]="formGroup" (ngSubmit)="onSubmit()">
  <div class="register-card">
    <mat-stepper class="bg-mt-step large-stepper" [linear]="isLinear" #stepper>
      <mat-step [stepControl]="accountGroup">
        <ng-template matStepLabel>
          <div class="step-header">
            <div>
              <div class="step-title">Cuenta</div>
              <div class="step-sub">Nombre y correo</div>
            </div>
          </div>
        </ng-template>

        <div class="step-body">
          <p class="step-desc">
            Introduce tu nombre completo y un correo válido; te servirá como usuario.
          </p>
          <div [formGroup]="accountGroup" class="form-column">
            <app-input
              id="register-student-name"
              label="Nombre"
              type="text"
              placeholder="Tu nombre completo"
              [control]="nameControl"
            />
            <app-input
              id="register-student-email"
              label="Correo Electrónico"
              type="text"
              placeholder="ejemplo@correo.com"
              [control]="emailControl"
            />
          </div>
        </div>

        <div class="step-actions">
          <button
            [disabled]="accountGroup.invalid"
            type="button"
            mat-flat-button
            color="primary"
            matStepperNext
          >
            Siguiente
          </button>
        </div>
      </mat-step>

      <mat-step [stepControl]="academicGroup">
        <ng-template matStepLabel>
          <div class="step-header">
            <div>
              <div class="step-title">Académico</div>
              <div class="step-sub">Carrera y contraseña</div>
            </div>
          </div>
        </ng-template>

        <div class="step-body">
          <p class="step-desc">
            Selecciona tu carrera y ciclo; crea una contraseña segura (mín. 6 caracteres).
          </p>
          <div [formGroup]="academicGroup" class="form-column">
            <app-select
              id="register-student-select-career"
              label="Carrera"
              [options]="careerGroup()"
              [control]="careerControl"
            />
            <app-select
              id="register-student-select-term"
              label="Ciclo"
              [options]="termOptions"
              panel="up"
              [control]="termControl"
            />
            <app-input
              id="register-student-password"
              label="Contraseña"
              type="password"
              placeholder="Contraseña"
              [control]="passwordControl"
            />
            <app-input
              id="register-student-repeat-password"
              label="Repetir Contraseña"
              type="password"
              placeholder="Repetir Contraseña"
              [control]="repeatPasswordControl"
            />
          </div>
        </div>

        <div class="step-actions">
          <button type="button" mat-stroked-button class="btn-back" matStepperPrevious>
            Anterior
          </button>
          <button
            [disabled]="academicGroup.invalid"
            type="button"
            mat-flat-button
            color="primary"
            matStepperNext
          >
            Siguiente
          </button>
        </div>
      </mat-step>

      <mat-step [stepControl]="profileGroup">
        <ng-template matStepLabel>
          <div class="step-header">
            <div>
              <div class="step-title">Perfil</div>
              <div class="step-sub">Foto y confirmación</div>
            </div>
          </div>
        </ng-template>

        <div class="step-body">
          <p class="step-desc">Sube una foto y acepta los términos para crear tu cuenta.</p>
          <div [formGroup]="profileGroup" class="form-column">
            <app-profile-image-uploader
              [control]="profilePictureControl"
            ></app-profile-image-uploader>
            <mat-checkbox [formControl]="acceptConditionsControl"
              >Acepto términos y condiciones</mat-checkbox
            >
          </div>
        </div>

        <div class="step-actions">
          <button type="button" mat-stroked-button class="btn-back" matStepperPrevious>
            Anterior
          </button>
          <button
            [disabled]="profileGroup.invalid"
            type="button"
            mat-flat-button
            color="primary"
            matStepperNext
          >
            Siguiente
          </button>
        </div>
      </mat-step>

      <!-- Review / Summary Step -->
      <mat-step>
        <ng-template matStepLabel>
          <div class="step-header">
            <div>
              <div class="step-title">Resumen</div>
              <div class="step-sub">Revisa tus datos antes de crear la cuenta</div>
            </div>
          </div>
        </ng-template>

        <div class="step-body review-body">
          <div class="review-card">
            <div class="review-image">
              <img [src]="profilePictureValue()" alt="" />
              <ng-template #noImage>
                <div class="no-image">Sin imagen</div>
              </ng-template>
            </div>
            <div class="review-data">
              <h3 class="review-title">{{ userResume().username }}</h3>
              <p class="review-line"><strong>Email:</strong> {{ userResume().email }}</p>
              <p class="review-line"><strong>Carrera (id):</strong> {{ userResume().career }}</p>
              <p class="review-line"><strong>Ciclo:</strong> {{ userResume().term }}</p>
              <p class="review-line">
                <strong>Acepta términos:</strong>
                {{ profileGroup.value.acceptConditions ? 'Sí' : 'No' }}
              </p>
            </div>
          </div>
        </div>

        <div class="step-actions">
          <button type="button" mat-stroked-button class="btn-back" matStepperPrevious>
            Anterior
          </button>
          <button mat-flat-button color="primary" type="submit" [disabled]="formGroup.invalid">
            Crear Cuenta
          </button>
        </div>
      </mat-step>
    </mat-stepper>
  </div>
</form>
