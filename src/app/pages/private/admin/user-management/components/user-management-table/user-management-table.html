<section class="section-table-container">
  <!-- Search Panel -->
  <app-user-management-search-form />

  <!-- Search Results Info -->
  <div class="search-results-info">
    <mat-icon>info</mat-icon>
    <span>Mostrando {{ paginatedData().length }} de {{ totalItems() }} resultados</span>
  </div>

  <!-- Actions Header -->
  <div class="header-actions">
    <p class="p-selected-user">
      Usuarios Seleccionados: <span class="section-count-user">{{ countUser() }}</span>
    </p>
    @if (countUser() > 0) {
    <button
      mat-raised-button
      color="warn"
      (click)="deleteSelected()"
      class="delete-selected-button"
    >
      <mat-icon>delete_sweep</mat-icon>
      Eliminar Seleccionados ({{ countUser() }})
    </button>
    }
  </div>

  <!-- Data Table Card -->
  <mat-card class="dashboard-card">
    <mat-card-content>
      <div class="table-container">
        <table mat-table [dataSource]="paginatedData()" class="user-table">
          <!-- ID Column -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef>ID</th>
            <td mat-cell *matCellDef="let user">{{ user.id }}</td>
          </ng-container>

          <!-- Name Column -->
          <ng-container matColumnDef="username">
            <th mat-header-cell *matHeaderCellDef>Nombre</th>
            <td mat-cell *matCellDef="let user">{{ user.username }}</td>
          </ng-container>

          <!-- Email Column -->
          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef>Correo</th>
            <td mat-cell *matCellDef="let user">{{ user.email }}</td>
          </ng-container>

          <!-- Roles Column -->
          <ng-container matColumnDef="role">
            <th mat-header-cell *matHeaderCellDef>Rol</th>
            <td mat-cell *matCellDef="let user">
              @for (role of user.roles; track role.id) {
              <span
                class="role-badge"
                [class.admin]="role.roleName === 'ADMIN'"
                [class.moderator]="role.roleName === 'MODERATOR'"
              >
                {{ role.roleName | titlecase }}
              </span>
              }
            </td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="state">
            <th mat-header-cell *matHeaderCellDef>Estado</th>
            <td mat-cell *matCellDef="let user">
              <span
                class="status-badge"
                [class.active]="user.state === true"
                [class.inactive]="user.state === false"
              >
                {{ user.state ? 'Activo' : 'Inactivo' }}
              </span>
            </td>
          </ng-container>

          <!-- Created Date Column -->
          <ng-container matColumnDef="creationDate">
            <th mat-header-cell *matHeaderCellDef>Fecha Creación</th>
            <td mat-cell *matCellDef="let user">{{ user.creationDate | date : 'short' }}</td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Acciones</th>
            <td mat-cell *matCellDef="let user" class="actions-cell">
              <button
                mat-icon-button
                color="primary"
                (click)="onUpdate(user); $event.stopPropagation()"
                matTooltip="Editar Usuario"
                class="action-button"
              >
                <mat-icon>edit</mat-icon>
              </button>
              <button
                mat-icon-button
                color="warn"
                (click)="onDelete(user); $event.stopPropagation()"
                matTooltip="Eliminar Usuario"
                class="action-button"
              >
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns"
            class="table-row"
            (click)="onRowClick(row)"
            [class.selected]="isSelected(row)"
            [attr.aria-selected]="isSelected(row)"
            tabindex="0"
            (keydown.enter)="onRowClick(row)"
          ></tr>
        </table>
      </div>

      <!-- Paginator -->
      <mat-paginator
        [length]="totalItems()"
        [pageSize]="pageSize"
        [pageIndex]="pageIndex"
        [pageSizeOptions]="pageSizeOptions"
        (page)="onPageChange($event)"
        showFirstLastButtons
        class="table-paginator"
      >
      </mat-paginator>
    </mat-card-content>
  </mat-card>
</section>
